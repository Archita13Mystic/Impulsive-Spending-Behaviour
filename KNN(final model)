print("\nFinal model training (KNN, 30% test size):")

X_train_final, X_test_final, y_train_final, y_test_final = train_test_split(
    X_scaled, y_enc,
    test_size=0.3,
    random_state=42,
    stratify=y_enc
)

knn_model = KNeighborsClassifier(n_neighbors=5)
knn_model.fit(X_train_final, y_train_final)

y_pred_final = knn_model.predict(X_test_final)

print(f"Accuracy: {accuracy_score(y_test_final, y_pred_final):.4f}")
print(f"\nF1-Score: {f1_score(y_test_final, y_pred_final, average='weighted'):.4f}")

print("\nClassification Report:")
print(classification_report(y_test_final, y_pred_final, 
                          target_names=le_target.classes_, 
                          zero_division=0))

print("\nConfusion Matrix:")
print(confusion_matrix(y_test_final, y_pred_final))
